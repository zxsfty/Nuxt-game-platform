<template>
  <div class="space-y-8 py-6 px-4 relative">
    <!-- å­£èŠ‚æ€§èƒŒæ™¯ -->
    <SeasonalBackground />
    
    <section class="hero-section bg-primary-light rounded-lg p-8 border border-primary-accent/30 transform transition-all duration-500 hover:shadow-theme relative overflow-hidden backdrop-blur-sm">
      <!-- ä½¿ç”¨å­£èŠ‚åœºæ™¯ç»„ä»¶ -->
      <SeasonalScene>
        <div class="hero-glow absolute inset-0 opacity-30"></div>
        <div class="max-w-3xl mx-auto text-center relative z-10">
          <h1 class="text-5xl font-bold mb-6 text-primary-accent animate-fadeIn font-serif seasonal-text-glow">
            The broken with star sinks
          </h1>
          <p class="text-xl mb-8 animate-fadeIn" style="animation-delay: 1.2s">The broken with star sinks</p>
          <button class="bg-primary-accent/80 hover:bg-primary-accent text-primary-light font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 relative overflow-hidden group">
            <span class="relative z-10 inline-flex items-center">
              ç«‹å³å¼€å§‹
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 transform transition-transform duration-300 group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </span>
            <span class="absolute inset-0 bg-primary-accent opacity-0 group-hover:opacity-100 transition-all duration-300"></span>
          </button>
        </div>
      </SeasonalScene>
    </section>

    <section class="features-section grid md:grid-cols-3 gap-6">
      <div 
        v-for="(feature, index) in features" 
        :key="index" 
        class="bg-primary-light p-6 rounded-lg border border-primary-accent/20 transition-all duration-300 transform hover:scale-102 hover:shadow-theme hover:border-primary-accent/50 relative overflow-hidden group"
        v-motion
        :initial="{ opacity: 0, y: 50 }"
        :enter="{ opacity: 1, y: 0, transition: { delay: index * 150 } }"
      >
        <div class="absolute inset-0 bg-gradient-to-br from-secondary-dark/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <div class="relative z-10">
          <div class="text-primary-accent text-3xl mb-4 transform transition-all duration-300 group-hover:scale-110">{{ feature.icon }}</div>
          <h3 class="text-xl font-bold mb-2 transition-colors duration-300 group-hover:text-primary-accent">{{ feature.title }}</h3>
          <p class="text-secondary-light transition-all duration-300 group-hover:text-primary-light">{{ feature.description }}</p>
        </div>
      </div>
    </section>

    <section class="games-section">
      <h2 
        class="text-3xl font-bold mb-6 text-center text-primary-accent relative inline-block w-full font-serif"
        v-motion
        :initial="{ opacity: 0, scale: 0.9 }"
        :enter="{ opacity: 1, scale: 1, transition: { duration: 800 } }"
      >
        <span class="relative z-10">çƒ­é—¨æ¸¸æˆ</span>
        <span class="absolute bottom-0 left-1/2 transform -translate-x-1/2 h-0.5 w-24 bg-gradient-to-r from-transparent via-primary-accent to-transparent"></span>
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div 
          v-for="(game, index) in games" 
          :key="index" 
          class="game-card bg-primary-light rounded-lg overflow-hidden border border-primary-accent/20 transition-all duration-300 transform hover:scale-105 hover:shadow-theme hover:border-primary-accent/50 relative"
          :class="`game-card-${$state.themeStyle.value}`"
          :style="{ 'animation-delay': `${index * 0.15}s` }"
          v-motion
          :initial="{ opacity: 0, x: index % 2 === 0 ? -50 : 50 }"
          :enter="{ opacity: 1, x: 0, transition: { delay: index * 150 } }"
        >
          <!-- èŠ‚æ°”ç‰¹å®šè£…é¥°å…ƒç´  -->
          <div class="seasonal-pattern absolute inset-0 opacity-5" :class="`${$state.themeStyle.value}-pattern`"></div>
          
          <!-- å¡ç‰‡è£…é¥°è¾¹è§’ -->
          <div class="absolute top-0 left-0 w-6 h-6 border-t-2 border-l-2 border-primary-accent/50 rounded-tl-lg"></div>
          <div class="absolute top-0 right-0 w-6 h-6 border-t-2 border-r-2 border-primary-accent/50 rounded-tr-lg"></div>
          <div class="absolute bottom-0 left-0 w-6 h-6 border-b-2 border-l-2 border-primary-accent/50 rounded-bl-lg"></div>
          <div class="absolute bottom-0 right-0 w-6 h-6 border-b-2 border-r-2 border-primary-accent/50 rounded-br-lg"></div>
          
          <div class="h-48 bg-secondary-dark flex items-center justify-center overflow-hidden group relative">
            <div class="absolute inset-0 bg-gradient-to-br from-secondary-dark to-transparent opacity-70"></div>
            <div class="absolute inset-0 bg-grid opacity-10"></div>
            <div class="text-6xl transition-all duration-500 transform group-hover:scale-125 group-hover:rotate-12 relative z-10 seasonal-emoji-glow">{{ game.emoji }}</div>
            <div class="absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-secondary-dark to-transparent opacity-0 group-hover:opacity-70 transition-opacity duration-300"></div>
          </div>
          <div class="p-4 relative">
            <h3 class="font-bold text-lg mb-2 transition-colors duration-300 hover:text-primary-accent seasonal-text-hover">{{ game.name }}</h3>
            <p class="text-sm text-secondary-light mb-2 italic seasonal-description">{{ game.seasonalDesc[$state.themeStyle.value] }}</p>
            <div class="flex justify-between items-center">
              <span class="text-primary-accent transition-all duration-300 hover:scale-110 inline-block seasonal-price">{{ game.price }}</span>
              <button class="text-sm bg-primary-accent/80 hover:bg-primary-accent text-primary-light px-3 py-1 rounded-full transition-all duration-300 transform hover:scale-105 relative overflow-hidden group">
                <span class="relative z-10">æŸ¥çœ‹è¯¦æƒ…</span>
                <span class="absolute inset-0 bg-primary-accent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup lang="ts">
import { useState } from 'nuxt/app'; // å¼•å…¥ Nuxt çš„ useState
import { ref, onMounted, watch, nextTick } from 'vue'; // å¼•å…¥ ref, onMounted, watch, nextTick
import SeasonalScene from '~/components/SeasonalScene.vue'; // å¼•å…¥å­£èŠ‚åœºæ™¯ç»„ä»¶
import SeasonalBackground from '~/components/SeasonalBackground.vue'; // å¼•å…¥å­£èŠ‚èƒŒæ™¯ç»„ä»¶

// ä½¿ç”¨Nuxtçš„useStateæ¥è·å–å½“å‰ä¸»é¢˜çŠ¶æ€
// ç»Ÿä¸€ä½¿ç”¨$state.themeStyle.valueçš„æ–¹å¼è®¿é—®ä¸»é¢˜çŠ¶æ€
const themeStyle = useState<string>('themeStyle', () => 'bailu'); // é»˜è®¤ä¸ºç™½éœ²ä¸»é¢˜ï¼Œä¿ç•™æ­¤å˜é‡ä»¥å…¼å®¹ç°æœ‰ä»£ç 

// åˆ›å»º$stateå¯¹è±¡ä»¥ä¸æ¨¡æ¿ä¸­çš„å¼•ç”¨ä¿æŒä¸€è‡´
const $state = {
  themeStyle
};

// è·å–ç‰¹æ•ˆå®¹å™¨çš„å¼•ç”¨
const dewDropsContainer = ref<HTMLElement | null>(null);
const fallingLeavesContainer = ref<HTMLElement | null>(null);
const snowflakesContainer = ref<HTMLElement | null>(null);

// å¯¼å…¥èŠ‚æµå‡½æ•°
import { throttle } from '~/utils/index';

// åˆ›å»ºåŠ¨ç”»å…ƒç´ çš„å‡½æ•°
const createElements = (container: HTMLElement | null, count: number, className: string, animationName: string) => {
  if (!container) return;
  container.innerHTML = ''; // æ¸…ç©ºæ—§å…ƒç´ 
  for (let i = 0; i < count; i++) {
    const element = document.createElement('div');
    element.classList.add(className);

    // éšæœºåŒ–å±æ€§
    const duration = Math.random() * 5 + 3; // 3-8s åŠ¨ç”»æ—¶é•¿
    const delay = Math.random() * 5; // 0-5s å»¶è¿Ÿ
    const startX = Math.random() * 100 + 'vw'; // éšæœºèµ·å§‹ X ä½ç½®
    const endXOffset = (Math.random() - 0.5) * 40 + 'vw'; // éšæœºç»“æŸ X åç§»
    const rotateZ = Math.random() * 360 + 'deg'; // éšæœº Z è½´æ—‹è½¬ (ç”¨äºå¶å­)

    element.style.left = startX;
    element.style.animationDuration = `${duration}s`;
    element.style.animationDelay = `${delay}s`;

    if (animationName === 'fallingLeaf') {
      element.style.setProperty('--leaf-end-x', endXOffset);
      element.style.setProperty('--leaf-rotate-z', rotateZ);
    } else if (animationName === 'snowfall') {
      element.style.setProperty('--snow-start-x', startX);
      element.style.setProperty('--snow-end-x', `calc(${startX} + ${endXOffset})`);
    }

    container.appendChild(element);
  }
};

// æ›´æ–°åŠ¨ç”»æ•ˆæœ
const updateAnimationsBase = async () => {
  await nextTick(); // ç­‰å¾… DOM æ›´æ–°
  dewDropsContainer.value = document.querySelector('.dew-drops-container');
  fallingLeavesContainer.value = document.querySelector('.falling-leaves-container');
  snowflakesContainer.value = document.querySelector('.snowflakes-container');

  if ($state.themeStyle.value === 'bailu') {
    createElements(dewDropsContainer.value, 15, 'dew-drop', 'dewDrop');
  } else {
    if (dewDropsContainer.value) dewDropsContainer.value.innerHTML = '';
  }

  if ($state.themeStyle.value === 'hanlu') {
    createElements(fallingLeavesContainer.value, 20, 'falling-leaf', 'fallingLeaf');
  } else {
    if (fallingLeavesContainer.value) fallingLeavesContainer.value.innerHTML = '';
  }

  if ($state.themeStyle.value === 'xiaohan') {
    createElements(snowflakesContainer.value, 30, 'snowflake', 'snowfall');
  } else {
    if (snowflakesContainer.value) snowflakesContainer.value.innerHTML = '';
  }
};

// ä½¿ç”¨èŠ‚æµå‡½æ•°ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½
const updateAnimations = throttle(updateAnimationsBase, 300);

// ç›‘å¬ä¸»é¢˜å˜åŒ–
watch(() => $state.themeStyle.value, updateAnimations);

// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–åŠ¨ç”»
onMounted(updateAnimations);

const features = [
  {
    icon: 'ğŸ®',
    title: 'æ¸¸æˆå¯åŠ¨å™¨',
    description: 'ä¸€é”®å¯åŠ¨æ‰€æœ‰æ¸¸æˆï¼Œç®¡ç†æ‚¨çš„æ¸¸æˆåº“'
  },
  {
    icon: 'ğŸ’¬',
    title: 'ç¤¾åŒºè®ºå›',
    description: 'ä¸å…¨çƒç©å®¶äº¤æµæ¸¸æˆå¿ƒå¾—å’Œæ”»ç•¥'
  },
  {
    icon: 'ğŸ’°',
    title: 'äº¤æ˜“å¸‚åœº',
    description: 'å®‰å…¨å¯é çš„è™šæ‹Ÿç‰©å“äº¤æ˜“å¹³å°'
  }
]

// å®šä¹‰æ¸¸æˆæ•°æ®çš„æ¥å£ï¼ŒåŒ…å«seasonalDescçš„ç±»å‹å®šä¹‰
interface GameData {
  emoji: string;
  name: string;
  price: string;
  seasonalDesc: Record<string, string>; // ä½¿ç”¨Recordç±»å‹å…è®¸å­—ç¬¦ä¸²ç´¢å¼•
}

const games: GameData[] = [
  {
    emoji: 'ğŸš€',
    name: 'æ˜Ÿé™…æ¢ç´¢',
    price: 'Â¥128',
    seasonalDesc: {
      bailu: 'æ¸…æ™¨çš„éœ²ç ä¸­å¯ç¨‹',
      hanlu: 'ç§‹å¶é£˜è½çš„æ˜Ÿé™…æ—…é€”',
      xiaohan: 'ç©¿è¶Šå†°é›ªæ˜Ÿç³»çš„å†’é™©'
    }
  },
  {
    emoji: 'ğŸ‘¾',
    name: 'å¤–æ˜Ÿå…¥ä¾µ',
    price: 'Â¥98',
    seasonalDesc: {
      bailu: 'æ™¨éœ²ä¸­çš„ç¥ç§˜è®¿å®¢',
      hanlu: 'ç§‹é£ä¸­çš„å¼‚æ˜Ÿæ¥å®¢',
      xiaohan: 'å†°å°ä¸–ç•Œçš„å…¥ä¾µè€…'
    }
  },
  {
    emoji: 'ğŸ¤–',
    name: 'æœºå™¨äººæˆ˜äº‰',
    price: 'Â¥158',
    seasonalDesc: {
      bailu: 'éœ²ç åå°„çš„æœºæ¢°æˆ˜åœº',
      hanlu: 'è½å¶çº·é£çš„é’¢é“å¯¹å†³',
      xiaohan: 'å†°é›ªè¦†ç›–çš„æœºæ¢°æˆ˜äº‰'
    }
  },
  {
    emoji: 'ğŸ›¸',
    name: 'UFOæ¨¡æ‹Ÿå™¨',
    price: 'Â¥88',
    seasonalDesc: {
      bailu: 'ç©¿è¶Šæ™¨éœ²çš„é£è¡Œ',
      hanlu: 'ç§‹æ—¥å¤©ç©ºçš„ç¥ç§˜é£è¡Œ',
      xiaohan: 'é›ªèŠ±é£˜è½ä¸­çš„é£è¡Œ'
    }
  }
]
</script>

<style scoped>
.hero-section {
  background-image: linear-gradient(to right, rgba(30, 41, 59, 0.8), rgba(30, 27, 75, 0.8));
  position: relative;
}

.hero-glow {
  background: radial-gradient(circle at center, rgba(59, 130, 246, 0.3), transparent 70%);
  filter: blur(20px);
  animation: pulse-glow 8s infinite alternate ease-in-out;
}

@keyframes pulse-glow {
  0% { opacity: 0.2; transform: scale(1); }
  50% { opacity: 0.4; transform: scale(1.1); }
  100% { opacity: 0.2; transform: scale(1); }
}

.glow-text-sm {
  text-shadow: 0 0 5px currentColor;
}

.glow-emoji {
  filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
}

.bg-grid {
  background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
  background-size: 20px 20px;
}

/* æ·»åŠ æ»šåŠ¨è§¦å‘åŠ¨ç”» */
@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

.hover\:scale-102:hover {
  transform: scale(1.02);
}

/* ç¡®ä¿èŠ‚æ°”èƒŒæ™¯å›¾æ¡ˆæ ·å¼å·²åœ¨å…¨å±€ CSS (themes.css) ä¸­å®šä¹‰ */
.bailu-pattern {
  /* background-image: url('@/assets/images/bailu-pattern.png'); */
}
.hanlu-pattern {
  /* background-image: url('@/assets/images/hanlu-pattern.png'); */
}
.xiaohan-pattern {
  /* background-image: url('@/assets/images/xiaohan-pattern.png'); */
}

/* ç¡®ä¿ç‰¹æ•ˆå®¹å™¨çš„æ ·å¼å·²åœ¨å…¨å±€ CSS (seasonal-animations.css) ä¸­å®šä¹‰ */
.dew-drops-container,
.falling-leaves-container,
.snowflakes-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* ç¡®ä¿ä¸å½±å“äº¤äº’ */
  z-index: 5; /* ç¡®ä¿åœ¨å†…å®¹ä¹‹ä¸‹ï¼Œä½†åœ¨èƒŒæ™¯ä¹‹ä¸Š */
}

.seasonal-text-glow {
  /* å¯ä»¥åœ¨ themes.css ä¸­ä¸ºä¸åŒä¸»é¢˜å®šä¹‰ä¸åŒçš„æ–‡æœ¬è¾‰å…‰æ•ˆæœ */
  text-shadow: 0 0 8px var(--primary-accent);
}

/* æ¸¸æˆå¡ç‰‡èŠ‚æ°”ç‰¹å®šæ ·å¼ */
.game-card {
  isolation: isolate;
  backdrop-filter: blur(2px);
}

/* ç™½éœ²ä¸»é¢˜æ¸¸æˆå¡ç‰‡ */
.game-card-bailu {
  box-shadow: 0 0 15px rgba(var(--decoration-color-1), 0.1);
}
.game-card-bailu:hover {
  box-shadow: 0 0 20px rgba(var(--decoration-color-1), 0.3);
}
.game-card-bailu .seasonal-emoji-glow {
  filter: drop-shadow(0 0 5px rgba(var(--decoration-color-1), 0.7));
}

/* å¯’éœ²ä¸»é¢˜æ¸¸æˆå¡ç‰‡ */
.game-card-hanlu {
  box-shadow: 0 0 15px rgba(var(--decoration-color-1), 0.1);
}
.game-card-hanlu:hover {
  box-shadow: 0 0 20px rgba(var(--decoration-color-1), 0.3);
}
.game-card-hanlu .seasonal-emoji-glow {
  filter: drop-shadow(0 0 5px rgba(var(--decoration-color-1), 0.7));
}

/* å°å¯’ä¸»é¢˜æ¸¸æˆå¡ç‰‡ */
.game-card-xiaohan {
  box-shadow: 0 0 15px rgba(var(--decoration-color-1), 0.1);
}
.game-card-xiaohan:hover {
  box-shadow: 0 0 20px rgba(var(--decoration-color-1), 0.3);
}
.game-card-xiaohan .seasonal-emoji-glow {
  filter: drop-shadow(0 0 5px rgba(var(--decoration-color-1), 0.7));
}

/* èŠ‚æ°”ç‰¹å®šæ–‡æœ¬æ‚¬åœæ•ˆæœ */
.seasonal-text-hover:hover {
  text-shadow: 0 0 5px rgba(var(--decoration-color-1), 0.7);
}

/* èŠ‚æ°”ç‰¹å®šä»·æ ¼æ ·å¼ */
.seasonal-price {
  font-weight: bold;
  position: relative;
}
.seasonal-price::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(var(--decoration-color-1), 0.7), transparent);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}
.seasonal-price:hover::after {
  transform: scaleX(1);
}

/* èŠ‚æ°”æè¿°æ–‡æœ¬æ ·å¼ */
.seasonal-description {
  min-height: 2.5rem;
  font-style: italic;
  opacity: 0.8;
  transition: all 0.3s ease;
}

.game-card:hover .seasonal-description {
  opacity: 1;
  color: rgba(var(--decoration-color-1), 0.9);
}

/* æ¸¸æˆå¡ç‰‡è¿›å…¥åŠ¨ç”»ä¼˜åŒ– */
@keyframes card-entrance-bailu {
  from { opacity: 0; transform: translateY(20px); box-shadow: 0 0 0 rgba(var(--decoration-color-1), 0); }
  to { opacity: 1; transform: translateY(0); box-shadow: 0 0 15px rgba(var(--decoration-color-1), 0.2); }
}

@keyframes card-entrance-hanlu {
  from { opacity: 0; transform: translateY(20px); box-shadow: 0 0 0 rgba(var(--decoration-color-1), 0); }
  to { opacity: 1; transform: translateY(0); box-shadow: 0 0 15px rgba(var(--decoration-color-1), 0.2); }
}

@keyframes card-entrance-xiaohan {
  from { opacity: 0; transform: translateY(20px); box-shadow: 0 0 0 rgba(var(--decoration-color-1), 0); }
  to { opacity: 1; transform: translateY(0); box-shadow: 0 0 15px rgba(var(--decoration-color-1), 0.2); }
}
</style>